---
name: progress-tracker
description: 从排期中定位“当前/下一任务”，并核对文档进度与真实代码是否一致。用于“检查进度”“下一个任务”“what's next”等场景，是 dev-workflow 第 2 阶段。
metadata:
  category: progress-tracking
  triggers: "status, what's next, find task, 检查进度, 下一个任务, 定位任务"
allowed-tools: Read Bash(python:*)
---

# 进度追踪与任务定位（Progress Tracker）

这个技能是开发 GPS：告诉你“现在在哪”“下一步做什么”，并防止进度表和真实代码脱节。

> 单一职责：定位 → 校验 → 确认

---

## 适用场景

- 想知道“下一个任务是什么”
- 想核对“当前进度是否真实”
- 长时间中断后恢复开发
- 作为 `dev-workflow` 的 Stage 2

---

## 工作流程

1. 数据收集：读取规范排期
2. 进度校验：对照代码与测试现状
3. 任务定位：给出唯一当前任务
4. 用户确认：确认后再进入实现

---

## Step 1：数据收集

1. 读取 `.github/skills/spec-sync/specs/06-schedule.md`
2. 识别任务状态标记：

| 标记 | 含义 |
|---|---|
| `[ ]` | 未开始 |
| `[~]` | 进行中 |
| `[x]` | 已完成 |
| `(进行中)` | 进行中 |
| `(已完成)` | 已完成 |

3. 构建当前任务列表（按阶段与顺序）

---

## Step 2：进度一致性校验

### 2.1 对已完成/进行中的任务做产物核验

例如：

- 文件是否存在
- 关键模块是否可导入
- 关联测试是否存在

### 2.2 常见不一致类型

| 类型 | 说明 | 严重度 |
|---|---|---|
| `MISSING_FILE` | 文档标完成，但文件不存在 | 高 |
| `IMPORT_ERROR` | 文件存在但不可导入 | 高 |
| `MISSING_TESTS` | 实现存在但缺测试 | 中 |
| `STALE_PROGRESS` | 长期“进行中”无推进 | 中 |

### 2.3 不一致处理

发现不一致时，必须提示用户选择：

1. 修正文档进度（更新 `DEV_SPEC.md`）
2. 用户确认“实际已完成”（说明代码位置/原因）
3. 按真实代码状态继续

---

## Step 3：定位唯一任务

优先级规则：

1. 若存在 `IN_PROGRESS`，它就是当前任务
2. 否则取第一个 `NOT_STARTED` 作为下一任务
3. 若全部完成，返回 `ALL_COMPLETE`

输出应包含：

- Task ID / 名称
- 所属阶段
- 对应规范章节
- 依赖任务是否满足

---

## Step 4：用户确认

在进入 implement 前，必须等待用户明确确认：

- `confirm/确认`：继续
- `override/指定其他`：改为用户指定任务（先验证存在）
- `cancel/取消`：结束流程

---

## 快捷模式

| 指令 | 行为 |
|---|---|
| `status` / `检查进度` | 执行 Step 1-3，仅报告 |
| `what's next` / `下一个任务` | 执行 Step 1-3，定位下一任务 |
| `find task` / `定位任务` | 执行完整流程（含确认） |
| `validate` / `验证进度` | 仅执行一致性校验（Step 2） |

---

## 输出契约

状态类型：`OK` | `MISMATCH` | `ALL_COMPLETE` | `CANCELLED`

- `OK`：返回任务信息与引用规范
- `MISMATCH`：返回不一致项与待用户决策项
- `ALL_COMPLETE`：说明全部任务完成
- `CANCELLED`：用户取消流程

---

## 关键规则

1. 必须先校验再定位，不能只看文档标记。
2. 必须用户确认后才进入实现。
3. 一次只给一个任务，禁止批量推进。
4. 允许退化：当拆分规范缺失时，可回退直接读 `DEV_SPEC.md`。
